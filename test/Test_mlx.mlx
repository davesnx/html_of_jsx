let tag () =
  let div = <div /> in
  assert_string (JSX.render div) "<div></div>"

let empty_attribute () =
  let div = <div class_="" /> in
  assert_string (JSX.render div) {|<div class=""></div>|}

let bool_attribute () =
  let div = <div hidden=true /> in
  assert_string (JSX.render div) {|<div hidden></div>|}

let bool_attributes () =
  let input =
    <input type_="checkbox" name="cheese" checked=true disabled=false />
  in
  assert_string (JSX.render input)
    {|<input type="checkbox" name="cheese" checked />|}

let innerhtml () =
  let p = <p>(JSX.string "text")</p> in
  assert_string (JSX.render p) {|<p>text</p>|}

let int_attribute () =
  let div = <div tabindex=1 /> in
  assert_string (JSX.render div) {|<div tabindex="1"></div>|}

let style_attribute () =
  let div = <div style="background-color:gainsboro" /> in
  assert_string (JSX.render div)
    {|<div style="background-color:gainsboro"></div>|}

let link_as_attribute () =
  let link =
    <link as_="image" rel="preload" href="https://sancho.dev/blog" />
  in
  assert_string (JSX.render link)
    {|<link as="image" rel="preload" href="https://sancho.dev/blog" />|}

let int_opt_attribute_some () =
  let tabindex = Some 1 in
  let div = <div ?tabindex /> in
  assert_string (JSX.render div) {|<div tabindex="1"></div>|}

let int_opt_attribute_none () =
  let tabindex = None in
  let div = <div ?tabindex /> in
  assert_string (JSX.render div) {|<div></div>|}

(* let lists_as_children () =
     let div = <> <div class_="md:w-1/3" /> <div class_="md:w-2/3" /> </> in
     assert_string(
       (JSX.render(div))
       {|<div class="md:w-1/3"></div><div class="md:w-2/3"></div>|}
     )) *)

module Container = struct
  let make ?children () =
    match children with Some child -> <div>child</div> | None -> JSX.null
end

let children_uppercase () =
  let component = <Container /> in
  assert_string (JSX.render component) ""

let children_uppercase_children_case_optional () =
  let component = <Container><span /></Container> in
  assert_string (JSX.render component) {|<div><span></span></div>|}

let children_lowercase () =
  let component = <div><span /></div> in
  assert_string (JSX.render component) {|<div><span></span></div>|}

let string_opt_attribute_some () =
  let class_ = Some "foo" in
  let div = <div ?class_ /> in
  assert_string (JSX.render div) {|<div class="foo"></div>|}

let string_opt_attribute_none () =
  let class_ = None in
  let div = <div ?class_ /> in
  assert_string (JSX.render div) {|<div></div>|}

let bool_opt_attribute_some () =
  let hidden = Some true in
  let div = <div ?hidden /> in
  assert_string (JSX.render div) {|<div hidden></div>|}

let bool_opt_attribute_none () =
  let hidden = None in
  let div = <div ?hidden /> in
  assert_string (JSX.render div) {|<div></div>|}

let style_opt_attribute_some () =
  let style = Some "color: blue;" in
  let div = <div ?style /> in
  assert_string (JSX.render div) {|<div style="color: blue;"></div>|}

let style_opt_attribute_none () =
  let style = None in
  let div = <div ?style /> in
  assert_string (JSX.render div) {|<div></div>|}

let onclick_inline_string () =
  let onClick = "console.log('clicked')" in
  let div = <div onclick=onClick /> in
  assert_string (JSX.render div)
    {|<div onclick="console.log(&apos;clicked&apos;)"></div>|}

let svg () =
  assert_string
    (JSX.render
       <svg
         xmlns="http://www.w3.org/2000/svg"
         viewBox="0 0 24 24"
         width="24px"
         height="24px">
         <path
           d="M 5 3 C 3.9069372 3 3 3.9069372 3 5 L 3 19 C 3 20.093063 \
              3.9069372 21 5 21 L 19 21 C 20.093063 21 21 20.093063 21 19 L 21 \
              12 L 19 12 L 19 19 L 5 19 L 5 5 L 12 5 L 12 3 L 5 3 z M 14 3 L \
              14 5 L 17.585938 5 L 8.2929688 14.292969 L 9.7070312 15.707031 L \
              19 6.4140625 L 19 10 L 21 10 L 21 3 L 14 3 z"
         />
       </svg>)
    {|<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px"><path d="M 5 3 C 3.9069372 3 3 3.9069372 3 5 L 3 19 C 3 20.093063 3.9069372 21 5 21 L 19 21 C 20.093063 21 21 20.093063 21 19 L 21 12 L 19 12 L 19 19 L 5 19 L 5 5 L 12 5 L 12 3 L 5 3 z M 14 3 L 14 5 L 17.585938 5 L 8.2929688 14.292969 L 9.7070312 15.707031 L 19 6.4140625 L 19 10 L 21 10 L 21 3 L 14 3 z"></path></svg>|}

module Component = struct
  let make ~(children : JSX.element) ~(_cosas : _) () = <div>children</div>
end

let children_one_element () =
  assert_string
    (JSX.render <Component _cosas=true><span /></Component>)
    {|<div><span></span></div>|}

module Text = struct
  module Tag = struct
    type t = H1 | H2

    let unwrap = function H1 -> "h1" | H2 -> "h2"
  end

  let make ~tagType ~children () =
    JSX.node (tagType |> Tag.unwrap) [] [ children ]
end

let create_element_variadic () =
  let component = <Text tagType=Text.Tag.H1>(JSX.string "Hello")</Text> in
  assert_string (JSX.render component) {|<h1>Hello</h1>|};
  let component = <Text tagType=Text.Tag.H2>(JSX.string "Hello")</Text> in
  assert_string (JSX.render component) {|<h2>Hello</h2>|}

let aria_props () =
  let component =
    <h1 aria_hidden=true aria_label="send email" aria_atomic=true>
      (JSX.string "Hello")
    </h1>
  in
  assert_string (JSX.render component)
    {|<h1 aria-hidden="true" aria-label="send email" aria-atomic="true">Hello</h1>|}

let lowercase_component () =
  let component ~text () = <h1>(JSX.string text)</h1> in

  assert_string (JSX.render <component text="Hello" />) {|<h1>Hello</h1>|}

let tests =
  ( "Test with mlx",
    [
      test "tag" tag;
      test "empty_attribute" empty_attribute;
      test "bool_attribute" bool_attribute;
      test "bool_attributes" bool_attributes;
      test "innerhtml" innerhtml;
      test "int_attribute" int_attribute;
      test "svg" svg;
      test "style_attribute" style_attribute;
      test "link_as_attribute" link_as_attribute;
      test "int_opt_attribute_some" int_opt_attribute_some;
      test "int_opt_attribute_none" int_opt_attribute_none;
      test "string_opt_attribute_some" string_opt_attribute_some;
      test "string_opt_attribute_none" string_opt_attribute_none;
      test "bool_opt_attribute_some" bool_opt_attribute_some;
      test "bool_opt_attribute_none" bool_opt_attribute_none;
      test "style_opt_attribute_some" style_opt_attribute_some;
      test "style_opt_attribute_none" style_opt_attribute_none;
      test "children_uppercase" children_uppercase;
      test "children_lowercase" children_lowercase;
      test "onclick_inline_string" onclick_inline_string;
      test "children_one_element" children_one_element;
      test "create_element_variadic" create_element_variadic;
      test "aria_props" aria_props;
      test "lowercase_component" lowercase_component;
    ] )
